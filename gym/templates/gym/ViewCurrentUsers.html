{% extends "header.html" %}
{% load userFilter %}
{% block title %}User Table in Gym Room{% endblock %}

{% load static %}
{% block cssfile %}
<link href="{% static '/css/test.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<div class="container">
	<div class="row">
		<div class="col-sm">
			<h1>Gym room {%if users|length >= max %} <span id="fullMsg">Full</span>{% endif %}</h1>
		</div>
		<div class="col-sm"  style="text-align:right;  margin: auto;">
			{% if admin and users|length >= max %}
			<form>
				<a href="/gym/admit/addForm">
					<button type="button" class="btn btn-primary">add to waiting</button>
				</a>
			</form>
			{% elif admin %}
			<form>
				<a href="/gym/admit/addForm" {% if waitUsers %} class="disabled"{% endif %}>
					<button type="button" class="btn btn-primary">add to gym</button>
				</a>
			</form>
			{% endif %}
		</div>
	</div>
</div>

<table class="table table-hover table-sm">
	<thead>
		<tr>
			<th>#</th>
			<th>User ID</th>
			<th>User Name</th>
			<th>Entry Time</th>
			{% if admin %}
			<th>Action</th>
			{% endif %}
		</tr>
	</thead>
	<tbody id="myTable">
		{%for user in users%}
		<tr>
			{% if admin %}
			<td>{{forloop.counter}}</td>
			<td id="userId">{{user.userId.id }}</td>
			<td>{{user.userId.name}}</td>
			<td>{{user.entryTime}}</td>
			<td>
				<form action="/gym/admit/leaveGym" method='get'>
					<input type="hidden" name="userId" value="{{user.userId.id}}">
					<button type="submit" class="btn btn-primary">leave Gym</button>
				</form>
			</td>
			{% elif not admin%}
			<td>{{forloop.counter}}</td>
			<td id="userId">{{user.userId.id|reId }}</td>
			<td>{{user.userId.name|reName}}</td>
			<td>{{user.entryTime}}</td>
			{% endif%}
		</tr>
		{% endfor %}
	</tbody>
</table>
	{% if waitUsers %}
		<h1>Waiting List</h1>
		<table class="table table-hover table-sm">
			<thead>
				<tr>
					<th>#</th>
					<th>User ID</th>
					<th>User Name</th>
					<th>waitTime</th>
					{% if admin %}
					<th>Action</th>
					{% endif %}
				</tr>
			</thead>
			{%for waituser in waitUsers%}
			<tr>
				{% if admin%}
				<td>{{forloop.counter}}</td>
				<td>{{waituser.userId.id}}</td>
				<td>{{waituser.userId.name}}</td>
				<td>{{waituser.waitTime}}</td>
				{% elif not admin %}
				<td>{{forloop.counter}}</td>
				<td>{{waituser.userId.id|reId}}</td>
				<td>{{waituser.userId.name|reName}}</td>
				<td>{{waituser.waitTime}}</td>
				{% endif %}
				{% if forloop.first and admin %}
				<td>
					<div class="row mx-auto">
						<div class="col-sm">
							<form action="/gym/admit/addGym" method='get'>
								<div class="form-group">
									<input type="hidden" name="userId" value="{{waituser.userId.id}}">
									<button type="submit" class="btn btn-primary">add to Gym</button>
								</div>
							</form>
						</div>
						<div class="col-sm">
							<form action="/gym/admit/importRemove" method='get' onsubmit="return confirm('Do you confirm to delete {{waituser.userId.id}} {{waituser.userId.name}}?')">
								<div class="form-group">
									<input type="hidden" name="userId" value="{{waituser.userId.id}}">
									<button type="submit" class="btn btn-danger">Delete</button>
								</div>
							</form>
						</div>
					</div>
				</td>
				{% endif %}
			</tr>
			{% endfor %}
		</table>
	{% endif %}

		{% if messages %}
        <script>
            {% for msg in messages %}
                alert('{{ msg.message }}');
            {% endfor %}
        </script>

		
        {% endif %}


{% endblock %}